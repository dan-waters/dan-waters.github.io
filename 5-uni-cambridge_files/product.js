function initProductPage(){hideProductButtons(),renderReadMoreButton(el("product-description-preview-button")),renderReadMoreButton(el("product-specification-preview-button")),$.ajax({type:"GET",url:"?json",success:initJson,error:ajaxFailHandler}),$(window).resize(onProductWindowResize),storeProductInfo(),initHeartRating(),renderGalerySlider(),initProductReviews(),initProductSlider(),updatePopover(),g_instore_mode&&$("#save_for_later_anchor").hide(),g_prod_min_price=$("#min_price").html(),g_prod_min_cmp_price=$("#cmp_price").html();var eol_product_msg=$(".eol_product_msg");eol_product_msg.length>0&&initEolProductMode()}function initJson(data){g_variantArr=data.variant_arr,g_ggl_prod_arr=data.ggl_prod_arr,g_prod_sfl=data.wishlist,g_prod_review_count=data.review_count,g_prod_review_score=data.review_score,onReloadProductPersonalisationComplete(g_prod_sfl),loadAllPromos();for(var i=0;i<g_variantArr.length;i++){var variant=g_variantArr[i];if(variant.show_promotion_notice){$("#promotion_calc_notice").show();break}}if($(".p_attr").show(),$(".primary-product-purchase-spinner").hide(),promotion_arr===!1&&(promotion_arr=void 0===g_variantArr[0]?[]:g_variantArr[0].promo_arr),compileQualifyingVariants(),renderPriceWasInfo(),renderPromotion(),g_prod_id=void 0===g_variantArr[0]?0:g_variantArr[0].prod_id,URLCheckForPostLoginOpts(),equaliseHeights(".product-collection-sets .product-name"),equaliseHeights(".product-collection-sets .product-dyn-price"),1===g_variantArr.length){var variant=g_variantArr[0];return renderVariantView(variant,!0),g_remainingVariants.push(variant),renderGalerySlider(variant.id),showProductButton("add_to_basket"),void productLikeFind()}if(window.location.hash){var hash=window.location.hash.substring(1);if(isNaN(hash))return;for(i=0;i<g_variantArr.length;i++)if(g_variantArr[i].sku==hash){hash=g_variantArr[i].id;break}for(i=0;i<g_variantArr.length;i++)if(g_variantArr[i].id==hash)return selectAttrFilterByVariant(g_variantArr[i]),void productLikeFind()}else attemptGPS();showProductButton("select_options"),showEls([el("quantity-selector"),el("save_for_later_anchor")])}function initEolProductMode(){$("#promotions_wrapper, .price-details, #mto_wrapper, .product_fulfilment, .attribute-selector-container, #attribute-selector, #instore_only_control, .add-to-basket ").hide()}function checkAffiliateReferrer(){var url=window.location.href;if(window.localStorage.affiliate_track){if(Date.now()-window.localStorage.affiliate_track<2592e3)return;window.localStorage.removeItem("affiliate_track")}if(url.indexOf("utm_")!==-1){var url_arr=url.split("?"),arg_str=url_arr[url_arr.length-1];arg_str=arg_str.split("#")[0];for(var single_arg_arr,key,val,arg_arr=arg_str.split("&"),i=0;i<arg_arr.length;i++)single_arg_arr=arg_arr[i].split("="),key=single_arg_arr[0],val=single_arg_arr[1],val&&(arg_arr[i]={},arg_arr[i][key]=val);setAffiliateLocalStorage(arg_arr)}}function setAffiliateLocalStorage(arg_arr){arg_arr.push({epoch_ts:Date.now()}),localStorage.setItem("affiliate_track",JSON.stringify(arg_arr))}function updatePopover(){$(".select_options_popover").on("click",popoverToggle)}function popoverToggle(){1===g_remainingVariants.length?$(".select_options_popover").popover("destroy"):$(".select_options_popover").popover("show")}function initProductReviews(){var product_id=el("product_id").value;loadReviewsCall=$.ajax({type:"GET",url:"?action=loadreviews&pid="+product_id+"&page=1"}),loadReviewsCall.then(renderProductReviews,ajaxFailHandler)}function renderProductReviews(data,status,xhr){if(1!=xhr.getResponseHeader("no-more-reviews")&&"undefined"!=xhr.getResponseHeader("no-more-reviews")||(el("load_more_reviews").style.display="none"),exists(el("review"))){var review_section=el("review");review_section.innerHTML+=data}reviewsApplyCustomerPersonalisation(),g_customerUsername&&$("#prod_review_top_href").html('<a href="#" class="primary_colour" onclick="openNewReviewInputs()">Leave a review</a>'),g_instore_mode&&($("#new_review_button").hide(),$(".no_reviews_info").css("margin-top","50px").html("This product currently has no reviews"))}function renderProductSortReviews(data,status,xhr){if(el("load_more_reviews").style.display=1==xhr.getResponseHeader("no-more-reviews")||"undefined"==xhr.getResponseHeader("no-more-reviews")?"none":"block",exists(el("review"))){var review_section=el("review");review_section.innerHTML=data}reviewsApplyCustomerPersonalisation(),g_customerUsername&&$("#prod_review_top_href").html('<a href="#" class="primary_colour" onclick="openNewReviewInputs()">Leave a review</a>'),g_posMode&&($("#new_review_button").hide(),$(".no_reviews_info").css("margin-top","50px").html("This product currently has no reviews"))}function renderProductReviewsPage(data,status,xhr){var load_more_btn=$("#load_more_reviews"),page_no=parseInt(load_more_btn.attr("data-page"),10);load_more_btn.attr("data-page",page_no+1),1==xhr.getResponseHeader("no-more-reviews")?load_more_btn.hide():load_more_btn.show();var review_section=el("review_list");review_section.innerHTML+=data,reviewsApplyCustomerPersonalisation(),g_customerUsername&&(el("prod_review_top_href").innerHTML='<a href="#" onclick="openNewReviewInputs()">Leave a review</a>')}function loadMoreReviews(){var product_id=el("product_id").value,page=getAttr(el("load_more_reviews"),"page");$("#load_more_reviews").hide(),loadReviewsCall=$.ajax({type:"GET",url:"?action=loadreviews&pid="+product_id+"&page="+page+"&order_by="+g_review_order}),loadReviewsCall.then(renderProductReviewsPage,ajaxFailHandler)}function reviewsApplyCustomerPersonalisation(){if(void 0===useful_review_arr)return $(".cta-container").hide();for(var i=0,arr_len=useful_review_arr.length;i<arr_len;i+=1){var review_id=useful_review_arr[i],rate_btn=$("#"+review_id+"_helpful_buttons");null!==rate_btn&&rate_btn.hide()}}function loadAllPromos(){varCount=g_variantArr.length,varArr=g_variantArr,g_fullPriceObj={promotionArr:[]},g_fullPromoObj={};for(var i=0;i<varCount;i++){var variant=varArr[i];if(null!=variant.promo_arr){g_fullPriceObj.promotionArr=variant.promo_arr;for(var j=0;j<g_fullPriceObj.promotionArr.length;j++){var id=g_fullPriceObj.promotionArr[j].promo_id;if(g_fullPromoObj.hasOwnProperty(id))g_fullPromoObj[id].push(variant.id);else{var variantPromoArr=[];variantPromoArr.push(variant.id),g_fullPromoObj[id]=variantPromoArr}}}}}function compileQualifyingVariants(){var varCount=g_remainingVariants.length,varArr=null;0!==varCount?varArr=g_remainingVariants:(varCount=g_variantArr.length,varArr=g_variantArr),g_filteredPrice={priceWas:null,priceWasArr:[],priceWasPercent:null,priceRRP:null,priceRRPArr:[],priceWasPercentArr:[],priceWasSave:null,priceWasSaveArr:[],promotionArr:[]},g_promoObj={};for(var i=0;i<varCount;i++){var variant=varArr[i];if(g_filteredPrice.priceWasArr.push(variant.price_was),g_filteredPrice.priceWasPercentArr.push(variant.price_was_percent),g_filteredPrice.priceWasSaveArr.push(variant.price_was_save),g_filteredPrice.priceRRPArr.push(variant.price_rrp),null!==variant.promo_arr&&null!==variant.promo_arr&&void 0!==variant.promo_arr){g_filteredPrice.promotionArr=variant.promo_arr;for(var j=0;j<g_filteredPrice.promotionArr.length;j++){var id=g_filteredPrice.promotionArr[j].promo_id;if(g_promoObj.hasOwnProperty(id))g_promoObj[id].push(variant.id);else{var variantPromoArr=[];variantPromoArr.push(variant.id),g_promoObj[id]=variantPromoArr}}}}filterCommonArrayValue("priceWasArr","priceWas"),filterCommonArrayValue("priceWasPercentArr","priceWasPercent"),filterCommonArrayValue("priceWasSaveArr","priceWasSave"),filterCommonArrayValue("priceRRPArr","priceRRP")}function filterCommonArrayValue(arrayProperty,resultProperty){var firstVal=g_filteredPrice[arrayProperty][0];for(sameVal=!0,i=1;i<g_filteredPrice[arrayProperty].length&&(sameVal=g_filteredPrice[arrayProperty][i]==firstVal,sameVal);i++);sameVal&&(g_filteredPrice[resultProperty]=firstVal)}function disableUnmatchedFilters(){var attrButton=$(this),name=attrButton.data("attrname"),val=attrButton.data("attrval");attrButton.hasClass("selected")||g_variantArr[i].attributes[name]==val||(attrButton.hasClass("attribute-square")?attrButton.addClass("disabled"):attrButton.parent().addClass("disabled"))}function calcFilterRelevance(){var attrButton=$(this),name=attrButton.data("attrname");if(g_activeFilters.hasOwnProperty(name))return!0;for(var val=attrButton.data("attrval"),relevant=!1,i=0;i<g_remainingVariants.length;i++)if(g_remainingVariants[i].attributes[name]==val){relevant=!0;break}return attrButton.hasClass("attribute-square")?void(relevant?attrButton.removeClass("disabled"):attrButton.addClass("disabled")):void(relevant?attrButton.parent().removeClass("disabled"):attrButton.parent().addClass("disabled"))}function renderAttrSpecification(){var html="";if(1===g_variantArr.length&&(g_remainingVariants=g_variantArr),null!==g_remainingVariants[0]){for(ind=0;ind<g_remainingVariants[0].product_specification.length;ind++)html+='<li data-state="selectable" ><span>'+g_remainingVariants[0].product_specification[ind]+"</span></li>";for(var attribute in g_remainingVariants[0].attributes){var name=attribute,value=g_remainingVariants[0].attributes[name];null!==value&&void 0!==value&&"_hex"!==name&&("_swatch"===name&&(name="Colour"),value='<li data-state="selectable" ><span>'+name+": "+value+"</span></li>",html.indexOf(value)===-1&&(html+=value))}}return g_prod_specs.html(html),html.length>0?(g_prod_specs.parent().show(),void renderReadMoreButton(el("product-specification-preview-button"))):void g_prod_specs.parent().hide()}function clearAttributeRowStates(attribute_name){$(g_availableFilters).each(function(){var filter_btn=$(this),attr_button="_swatch"===filter_btn.data("attrname")?filter_btn:filter_btn.parent();attr_button.data("attrname")===attribute_name&&attr_button.removeClass("selected out_of_tree").data("state","selectable")})}function clearAllAttributeRows(){showProductButton("loading"),$(g_availableFilters).each(function(){var filter_btn=$(this),attr_button="_swatch"===filter_btn.data("attrname")?filter_btn:filter_btn.parent();attr_button.removeClass("selected out_of_tree").data("state","selectable")}),el("selected-variant-id").value=""}function setAttributeRowToState(attribute_name,state){$(g_availableFilters).each(function(){var filter_btn=$(this),attr_button="_swatch"===filter_btn.data("attrname")?filter_btn:filter_btn.parent();attr_button.data("attrname")===attribute_name&&attr_button.removeClass("selected").data("state",state).addClass(state)})}function addAttributeFilter(attributeName,attributeValue){g_remainingVariants=0==g_remainingVariants.length?g_variantArr:g_remainingVariants,g_selectedAttributes.push({name:attributeName,value:attributeValue});for(var compatibaleVariantArr=[],a=0;a<g_remainingVariants.length;a++){for(var variant=g_remainingVariants[a],variant_attributes=variant.attributes,b=0;b<g_selectedAttributes.length;b++){var selected_attr_name=g_selectedAttributes[b].name,selected_attr_value=g_selectedAttributes[b].value,compatible=!0;if("_swatch"===selected_attr_name){for(var c=0;c<g_variantArr.length;c++)for(var variant_2=g_variantArr[c],d=0;d<variant_2.variant_colours.length;d++){var colour=variant_2.variant_colours[d];selected_attr_value==colour.hex&&(selected_attr_value=colour.hex)}null!=variant_attributes._hex&&variant_attributes._hex.toUpperCase()==selected_attr_value.toUpperCase()||(compatible=!1)}else variant_attributes[selected_attr_name].decodeHtml()!=selected_attr_value&&(compatible=!1)}compatible&&compatibaleVariantArr.push(variant)}if(g_remainingVariants=compatibaleVariantArr,$(g_availableFilters).each(function(){var filter_btn=$(this);filter_btn.removeClass("selectable"),filter_btn.removeClass("out_of_tree"),filter_btn.removeClass("selected");var is_swatch=!1;if("_swatch"===filter_btn.data("attrname")){var attr_button=filter_btn,is_swatch=!0;for(a=0;a<g_variantArr.length;a++)for(var variant=g_variantArr[a],b=0;b<variant.variant_colours.length;b++){var colour=variant.variant_colours[b];if(attr_button.data("attrval")===colour.hex)var button_value=colour.hex}}else var attr_button=filter_btn.parent(),button_value=attr_button.data("attrval");for(var button_name=(attr_button.data("state"),attr_button.data("attrname")),state="out_of_tree",a=0;a<g_remainingVariants.length;a++){var variant=g_remainingVariants[a],variant_attributes=variant.attributes;is_swatch?variant_attributes._hex==button_value&&(state="selectable"):variant_attributes[button_name]==button_value&&(state="selectable")}attr_button.addClass(state).data("state",state)}),1==g_remainingVariants.length){for($(g_availableFilters).each(function(){var attr_button="_swatch"===$(this).data("attrname")?$(this):$(this).parent();return"selectable"!==attr_button.data("state")||void attr_button.removeClass("selectable").data("state","selected").addClass("selected")}),renderPriceWasInfo(),a=0;a<g_remainingVariants.length;a++){renderVariantView(g_remainingVariants[a],!0),renderGalerySlider(g_remainingVariants[a].id);break}renderAttrSpecification()}else showProductButton("select_options")}function calculateMaxAttrCount(){var max_attr_count=0,last_attr_row=!1;return $(g_availableFilters).each(function(){var attr_button=$(this).parent(),button_name=attr_button.data("attrname");button_name!==last_attr_row&&max_attr_count++,last_attr_row=button_name}),max_attr_count}function onAttrFilterClicked(event){showProductButton("loading"),event.preventDefault();var btn="_swatch"===$(event.target).data("attrname")?$(event.target).parent().parent().parent():$(event.target).parent(),attributeName=(btn.data("displayname"),btn.data("attrname")),attributeValue=btn.data("attrval");g_availableFilters=$(".js-attribute-selectors").find(".js-filter-btn");var state=btn.data("state");switch("0"===g_prod_instore_only&&($(".product-delivery-options, #stock_loading_wrapper").hide(),$(".add-to-basket").show()),g_prod_title.html(g_prod_property.name),g_prod_specs.html(g_prod_property.specification),$("#product-was-price, #product-price-saving, #product-rrp-price").hide(),$("#product_urgent_val").html(""),$("#product_urgent").hide(),state){case"selectable":clearAttributeRowStates(attributeName),setAttributeRowToState(attributeName,"out_of_tree"),addAttributeFilter(attributeName,attributeValue),btn.data("state","selected").removeClass("out_of_tree").addClass("selected");break;case"selected":g_selectedAttributes=[],g_prod_code.html(g_ggl_prod_arr.code),g_remainingVariants=[],clearAllAttributeRows(),setAttributeRowToState(attributeName,"selectable"),g_selectedAttributes=[],$("#from_price").show(),$("#min_price").html(g_prod_min_price),$("#cmp_price").html(g_prod_min_cmp_price),$("#product-dyn-desc").show(),$("#product-dyn-variant-desc").empty(),renderReadMoreButton(el("product-description-preview-button")),renderReadMoreButton(el("product-specification-preview-button")),renderGalerySlider(),attemptGPS(),showProductButton("select_options"),onReloadProductPersonalisationComplete(g_prod_sfl);break;case"out_of_tree":g_selectedAttributes=[],g_remainingVariants=[],$("#from_price").show(),$("#min_price").html(g_prod_min_price),$("#cmp_price").html(g_prod_min_cmp_price),$("#product-dyn-desc").show(),$("#product-dyn-variant-desc").empty(),renderReadMoreButton(el("product-description-preview-button")),renderReadMoreButton(el("product-specification-preview-button")),clearAllAttributeRows(),setAttributeRowToState(attributeName,"out_of_tree"),addAttributeFilter(attributeName,attributeValue),btn.data("state","selected").removeClass("out_of_tree").addClass("selected")}return showSelectedAttributesValues(),compileQualifyingVariants(),renderPriceWasInfo(),renderPromotion(),updatePopover(),$(".js-attribute-title-value").is(":empty")&&$("#payKlarna").hide(),!1}function showProductButton(type){switch(hideProductButtons(),type){case"loading":$("#product-dyn-loading-btn").show();break;case"select_options":$("#collect_only_message").hide(),$("#product-dyn-select-options-btn").show();break;case"add_to_basket":$("#product-dyn-add-to-bskt-btn").show(),g_atb_on_load&&el("product-dyn-add-to-bskt-btn").click();break;case"out_of_stock":$("#product-dyn-out-of-stock-btn").show();break;case"check_stock":$("#product-dyn-check-store-stock-btn").show();break;case"unavailable":$("#product-dyn-unavailable-btn").show();break;case"unavailable_instore":$("#product-dyn-unavailable-instore-btn").show();break;case"cancel_email":$("#product-dyn-cancel-stock-email-btn").show();break;case"collect_only":$("#product-dyn-collect-only-btn").show(),$("#collect_only_message").hide();break;default:$("#product-dyn-loading-btn").show()}equaliseHeights("li.attribute-flex span"),g_atb_on_load=!1}function hideProductButtons(){$("#product-dyn-loading-btn, #product-dyn-select-options-btn, #product-dyn-add-to-bskt-btn, #product-dyn-out-of-stock-btn, #product-dyn-check-store-stock-btn, #product-dyn-unavailable-btn, #product-dyn-cancel-stock-email-btn, #product-dyn-collect-only-btn").hide()}function showSelectedAttributesValues(){$(".js-attribute-title-value").empty();for(var selected_arr=document.querySelectorAll(".p_attr > .attribute-selector-container > ul > li.selected"),i=0,arr_len=selected_arr.length;i<arr_len;i++){var current_attr=$(selected_arr[i]),attr_value="Colour"===current_attr.data("displayname")?current_attr.data("attrlabel"):current_attr.data("attrval");current_attr.parent().siblings(".attribute-title").children(".js-attribute-title-value").html(attr_value)}return!1}function onSaveForLaterClick(element,id,quantity){var selected_var_id=el("selected-variant-id").value,sfl_string=selected_var_id.length>0?selected_var_id:"product";if(g_customerUsername===!1){if("product"!==sfl_string)for(var i=0;i<g_variantArr.length;i++)g_variantArr[i].id==selected_var_id&&(sfl_string=g_variantArr[i].sku);return g_localStorageEnabled&&localStorage.setItem("sfl",sfl_string),openLoginModal("/login"),!1}return itemSaveForLater(g_prod_id,sfl_string,1,!1),element.dataset.saved=!0,!1}function itemSaveForLater(prod_id,variant_id,quantity,no_delete){void 0==no_delete&&(no_delete=!1);var variant_data="product"!==variant_id?"_"+variant_id:"",data={preference:"wishlist",id:prod_id+variant_data,no_delete:no_delete};$.ajax({type:"POST",url:"/myaccount",data:data,success:renderWishlistPreference,error:ajaxFailHandler})}function renderWishlistPreference(data){var added_to_wishlist="set"==data.success;added_to_wishlist?g_wishlist_count++:g_wishlist_count--,el("wishlist-icon").src=g_wishlist_count>0&&el("wishlist-icon")?"/img/like-heart-selected.png":"/img/masthead/heart.png",0===el("selected-variant-id").value.length&&(g_prod_sfl=added_to_wishlist),g_sfl_pending||onReloadProductPersonalisationComplete(added_to_wishlist)}function onReloadProductPersonalisationComplete(saved_for_later){$("#save_for_later_anchor").html("Save For Later"),$("#save_for_later_anchor").addClass("default default-md").removeClass("success success-md"),el("wishlist-icon").src=g_wishlist_count>0&&el("wishlist-icon")?"/img/like-heart-selected.png":"/img/masthead/heart.png",saved_for_later&&($("#save_for_later_anchor").html("Saved For Later"),$("#save_for_later_anchor").addClass("success success-md").removeClass("default default-md")),$("#save_for_later_anchor").fadeIn("200")}function updateSFL(data){return 1==data.wishlist?void itemSFLComplete():void itemSFLRemoved()}function itemSFLRemoved(){var save_for_later_anchor=el("save_for_later_anchor");save_for_later_anchor.setAttribute("data-saved","false"),save_for_later_anchor.innerHTML="Save For Later",$("#save_for_later_anchor").addClass("default default-md").removeClass("success success-md")}function itemSFLComplete(){var save_for_later_anchor=el("save_for_later_anchor");save_for_later_anchor.setAttribute("data-saved","true"),save_for_later_anchor.innerHTML="Saved For Later",$("#save_for_later_anchor").addClass("success success-md").removeClass("default default-md")}function renderVariantView(variant,price_cal){var eol_product_msg=$(".eol_product_msg");if(eol_product_msg.length>0)return void initEolProductMode();if(void 0!==variant.id){"C"!==variant.fulfilment||g_collectionEnabled?($("#collect_only_message").hide(),$.ajax({type:"POST",url:"?variantdetails&variant_id="+variant.id+"&prod_id="+g_prod_id,success:onLoadVariantDetails,error:ajaxFailHandler})):"C"===variant.fulfilment&&($("#geo_curr_loc_wrapper").hide(),$("#collect_only_message").show()),el("selected-variant-id").value=variant.id,g_prod_code.html(variant.code),g_prod_desc.html(variant.description_html),1===variant.desc_override&&$("#product-dyn-desc").hide(),renderReadMoreButton(el("product-description-preview-button")),renderReadMoreButton(el("product-specification-preview-button")),$(".variant-features").remove();var features_wrapper=g_prod_features.parent();if(0===g_prod_property.features.length&&features_wrapper.hide(),void 0!==variant.urg_stk_limit&&variant.urg_stk_limit&&"C"!==variant.fulfilment&&"Not applicable"===variant.age_restriction&&0===variant.child_hazard?($("#product_urgent_val").html(variant.urg_stk_limit),$("#product_urgent").show()):($("#product_urgent_val").html(""),$("#product_urgent").hide()),void 0!==variant.made_order&&variant.made_order&&$("#mto_wrapper").show(),price_cal){if(variant.features.length>0){for(var features_str="",i=0;i<variant.features.length;i++)features_str+='<li class="variant-features"><span>'+variant.features[i]+"</span></li>";g_prod_features.append(features_str),features_str.length>0&&features_wrapper.show()}$("#from_price").hide();var price=parseInt(variant.price),klarna_value_el=el("klarna-product-value");if(klarna_product_value=price<25e3?(price/300).toFixed(2):(price/1200).toFixed(2),null!=klarna_value_el&&(klarna_value_el.innerHTML=klarna_product_value),price=(price/100).toFixed(2),$("#min_price").html("£"+price),variant.pc_cmp_price&&$("#cmp_price").html("("+variant.pc_cmp_price+")"),variant.price<=7500?$("#payKlarna").hide():$("#payKlarna").show(),el("klarna-value").value=price,$(".product-delivery-options").show(),g_prod_title.html(variant.name),g_prod_goes_well&&(g_prod_goes_well.slick("unslick"),g_prod_goes_well.html(variant.goes_well),variant.goes_well?(g_prod_goes_well.closest(".goes-well-with-wrapper").show(),initGoesWellSlider(g_prod_goes_well)):g_prod_goes_well.closest(".goes-well-with-wrapper").hide()),"C"===variant.fulfilment&&!g_collectionEnabled)return $(".add-to-basket, #stock_loading_wrapper, #stk_request_location, #stk_delivery_methods, #geo_product_wrapper").hide(),void $("#stock_location_wrapper, #instore_only").show();$("#instore_only").hide();var param_arr=parseQueryString();for(index in param_arr)"atb"===index&&(g_atb_on_load=!0);return window.location.hash=variant.sku,void((product=findGTMProduct(variant.prod_id))?dataLayer.push({event:"productClick",ecommerce:{detail:{products:[{name:variant.attr_name,id:product.id,variant_id:variant.id,prod_id:variant.prod_id,price:variant.price/100,brand:product.brand,category:product.category}]}}}):console.log("ERROR: Cannot find Product for this Variant"))}null!==g_prod_goes_well&&(g_prod_goes_well.slick("unslick"),g_prod_goes_well.html(g_prod_property.goes_well),g_prod_goes_well.closest(".goes-well-with-wrapper").show(),initGoesWellSlider(g_prod_goes_well)),g_prod_price.html(variant.price),$("#thumbnail-image-list > a, .add-to-basket").show(),$(".product-delivery-options").hide(),showProductButton("select_options")}}function productInstoreOnly(){"0"!==g_prod_instore_only&&($(".product-delivery-options").show(),$(".add-to-basket, #stock_loading_wrapper, #stk_request_location").hide(),$("#stock_location_wrapper, #instore_only").show())}function renderPromotion(){g_show_price_was=!0,$("#promotions_wrapper").hide();for(var promo_elem=el("promotion_list"),promo_count=g_filteredPrice.promotionArr.length,variant_count=1===g_variantArr.length?g_variantArr.length:g_remainingVariants.length,multi_count=0,i=0,multi_count=0;i<promo_count;i++)1!==g_filteredPrice.promotionArr[i].promo_type&&4!==g_filteredPrice.promotionArr[i].promo_type||multi_count++;html='<div class="offer">';for(var skip_multi_promo=!1,blacklist_promo=[5,6],i=0;i<promo_count;i++){var promo=g_filteredPrice.promotionArr[i],label=promo.promo_name,type=promo.promo_type;if(!(blacklist_promo.indexOf(type)>-1))if($("#promotions_wrapper").show(),g_promoObj[promo.promo_id].length!==variant_count&&(label+=" on selected lines"),multi_count>1&&(1===type||4===type)){if(skip_multi_promo===!0)continue;skip_multi_promo=!0,html+='<a href="#bundle-promo-id'+promo.promo_id+'">'+multi_count+" bundle offers available</a><br>"}else html+=1===type||4===type?'<a href="#bundle-promo-id'+promo.promo_id+'">'+label+"</a><br>":label+"<br>"}html+="</div>",promo_elem.innerHTML=html}function onLoadVariantDetails(data){1===g_variantArr.length&&(g_remainingVariants=g_variantArr,renderAttrSpecification()),updateSFL(data),el("variant-stock").value=data.stock,$('#quantity-selector input[name="quantity"]').trigger("keyup"),onReloadProductPersonalisationComplete(data.wishlist),showProductButton(data.stock>0?"add_to_basket":data.stock_email===!0?"cancel_email":"out_of_stock"),null!==g_prod_goes_well&&(g_prod_goes_well.slick("unslick"),g_prod_goes_well.html(g_prod_property.goes_well),g_prod_goes_well.closest(".goes-well-with-wrapper").show(),initGoesWellSlider(g_prod_goes_well)),attemptGPS()}function renderGalerySlider(variant_id){variant_id=void 0!=variant_id&&variant_id;var slides="";$("#available-imgs > li").each(function(){var target=$(this);if(variant_id){for(var li_variant=target.attr("data-variant").split(","),contains_variant=!1,i=0;i<li_variant.length;i++)if(variant_id==li_variant[i]){contains_variant=!0;break}if(!contains_variant)return!0}slides+=target.html().trim()});var fullscreen={enabled:!0,nativeFS:!0};"c4"===determineDevice($(window).width())&&(fullscreen.enabled=!1),null!==g_galerySlider&&g_galerySlider.destroy();var media_slider=$("#product-gallery").royalSlider({slides:slides,fullscreen:fullscreen,controlNavigation:"thumbnails",autoScaleSlider:!1,loop:!0,imageScaleMode:"fit-if-smaller",imageScalePadding:1,navigateByClick:!1,numImagesToPreload:2,arrowsNav:!0,arrowsNavAutoHide:!1,arrowsNavHideOnTouch:!1,keyboardNavEnabled:!1,fadeinLoadedSlide:!0,globalCaption:!1,globalCaptionInside:!1,video:{autoHideArrows:!1,autoHideControlNav:!1,youTubeCode:'<iframe src="https://www.youtube.com/embed/%id%?autoplay=1&rel=0&showinfo=0&controls=0"></iframe>'},thumbs:{appendSpan:!0,firstMargin:!0,paddingBottom:4,drag:!0}});g_galerySlider=media_slider.data("royalSlider"),void 0!==g_galerySlider.currSlide&&(recalcThumbnailMargin(),reloadZoom(),g_galerySlider.ev.on("rsBeforeMove",rsBeforeMove),g_galerySlider.ev.off("rsAfterSlideChange").on("rsAfterSlideChange",reloadZoom),g_galerySlider.ev.off("rsOnCreateVideoElement").on("rsOnCreateVideoElement",convertToVideo),fullscreen.enabled&&(g_galerySlider.ev.off("rsSlideClick").on("rsSlideClick",onImageSliderClick),g_galerySlider.ev.off("rsEnterFullscreen").on("rsEnterFullscreen",recalcThumbnailMargin),g_galerySlider.ev.off("rsExitFullscreen").on("rsExitFullscreen",onRSExitFullscreen)))}function convertToVideo(e,url){g_galerySlider.currSlide.thumbnail.indexOf("youtubeEmbed")==-1&&(g_galerySlider.videoObj=$('<video style="background-color: #000;" autoplay><source class="rsVideoObj" src="'+url+'" type="video/mp4"></video>'))}function rsBeforeMove(event,type,userAction){var slider=$(".royalSlider").data("royalSlider");slider.stopVideo()}function onProductWindowResize(){clearTimeout(resizeTimer),resizeTimer=setTimeout(onProductWindowResizeStop,100)}function onProductWindowResizeStop(){clearTimeout(resizeTimer),recalcThumbnailMargin()}function onImageSliderClick(){var currSlide=g_galerySlider.currSlide;this.isFullscreen||void 0!==currSlide.videoURL?this.exitFullscreen():this.enterFullscreen()}function onRSExitFullscreen(){recalcThumbnailMargin(),reloadZoom()}function recalcThumbnailMargin(){var half_image_width=25,center=Math.round($(".rsOverflow").width()/2),number_thumbnails=document.querySelectorAll("#product-gallery .rsThumb").length;number_thumbnails>=5?(number_thumbnails=5,$(".rsThumbsContainer").removeClass("rsTransformNone")):$(".rsThumbsContainer").addClass("rsTransformNone");var margin=center-half_image_width*number_thumbnails,rsThumbsHorWidth=50*number_thumbnails;$(".rsThumbsHor").css("margin-left",margin+"px").css("width",rsThumbsHorWidth),jQuery(".royalSlider").royalSlider("updateSliderSize",!0)}function reloadZoom(){$(".zoomContainer").remove(),$(".rsImg.rsMainSlideImage").off("doubletap");var currSlide=g_galerySlider.currSlide;if(void 0===currSlide.videoURL){var src=currSlide.bigImage;if(null==src&&(src=currSlide.image),null!=src){var currSlide=currSlide.content.data("zoom-image",src),is_touch=isTouchDevice();"c1"===determineDevice($(window).width())||is_touch||currSlide.elevateZoom({zoomWindowPosition:2,borderSize:2,zoomWindowOffetx:15,responsive:!0,easing:!0})}}}function enableMobileZoom(){var currSlide=g_galerySlider.currSlide,src=currSlide.bigImage;null==src&&(src=currSlide.image);var currSlide=currSlide.content.data("zoom-image",src);currSlide.elevateZoom({zoomType:"inner",onZoomedImageLoaded:onMobileZoomLoaded})}function onMobileZoomLoaded(){$(".zoomContainer").off("touchend mouseout").on("touchend mouseout",disableMobileZoom)}function disableMobileZoom(event){var target=event.target,container=$(this);container.is(target)||container.remove()}function storeProductInfo(){g_prod_instore_only=el("instore_only_control").value,g_prod_title=$("#product-dyn-title"),g_prod_features=$("#product-dyn-features-ul"),g_prod_desc=$("#product-dyn-variant-desc"),g_prod_specs=$("#product-dyn-specification-ul"),g_prod_code=$("#product-dyn-code"),g_prod_price=$("#product-dyn-price"),g_prod_goes_well=$("#product-dyn-goes-well"),g_prod_property.name=g_prod_title.html().trim(),g_prod_property.features=g_prod_features.html().trim(),g_prod_property.specification=g_prod_specs.html().trim(),g_prod_property.code=g_prod_code.html().trim(),g_prod_property.price=g_prod_price.html().trim(),g_prod_property.goes_well=g_prod_goes_well.length?g_prod_goes_well.html().trim():null}function onBasketOptionClick(buttonAnchor,formId){if($(buttonAnchor).hasClass("selection"))return!1;$('#quantity-selector input[name="quantity"]').trigger("keyup"),onGTMProductBasketAdd(formId);var form_data=$("#"+formId).serialize();return $.ajax({type:"POST",url:"/basket",data:form_data,success:onItemAddedToBasket,error:ajaxFailHandler}),!1}function onLeafletBasketOptionClick(buttonAnchor,formId){if($(buttonAnchor).hasClass("selection"))return!1;$('#quantity-selector input[name="quantity"]').trigger("keyup"),onGTMProductBasketAdd(formId);var form_data=$(buttonAnchor).closest("#"+formId).serialize();return $.ajax({type:"POST",url:"/basket",data:form_data,success:onItemAddedToBasket,error:ajaxFailHandler}),$(".leaflet-sidebar.active").removeClass("active"),!1}function onItemAddedToBasket(data,status,xhr){if(void 0!==xhr.getResponseHeader("Local-Basket")){var local_basket=xhr.getResponseHeader("Local-Basket");local_basket!==!1&&saveBasketToLocalStorage(local_basket),g_localStorageEnabled&&local_basket===!1&&localStorage.removeItem("Local-Basket")}el("add-to-basket-modal-content").innerHTML=data,$.ajax({type:"POST",url:"/basket?action=getBasketItemCount",success:updateBasketPillCount,error:ajaxFailHandler}),lazyLoad(),$("#add_to_basket_modal").modal()}function toggleEmailBackInStockClick(is_remove){"undefined"!==is_remove&&is_remove===!0&&showProductButton("out_of_stock");var variant_id=el("selected-variant-id").value;return""!=variant_id&&(g_customerUsername===!1?(g_localStorageEnabled&&localStorage.setItem("ebis",variant_id),openLoginModal("/login"),!1):(emailBackInStock(variant_id),!1))}function emailBackInStock(variant_id,no_delete){if(!variant_id)return!1;no_delete||(no_delete=!1);var data={no_delete:no_delete,preference:"stock_email",variant_id:variant_id};$.ajax({type:"POST",url:"/myaccount",data:data,success:onEmailStockComplete,error:ajaxFailHandler})}function onEmailStockComplete(data){var response="set"==data.success?"cancel_email":"out_of_stock";showProductButton(response)}function removeBackInStockStyle(){showProductButton("out_of_stock")}function setBackInStockStyle(){showProductButton("cancel_email")}function initHeartRating(){var productCode=g_prod_property.code,score=null;null!==productCode&&!g_posMode&&g_localStorageEnabled&&(score=localStorage.getItem(productCode))}function selectHeartRating(score){if(!g_localStorageEnabled)return!1;var productCode=g_prod_property.code,localScore=localStorage.getItem(productCode);if(localScore!=score?localStorage.setItem(productCode,score):localScore==score&&1===score&&(localStorage.removeItem(productCode),score=0),renderHeartRating(score),!g_customerUsername)return void openLoginModal("/login");var prod_id=g_variantArr[0].prod_id,variant_id=el("selected-variant-id").value;""===variant_id&&(variant_id=0);var qty=document.getElementsByName("quantity")[0].value;$.ajax({type:"POST",prod_id:prod_id,variant_id:variant_id,score:score,qty:qty,url:"/basket?action=productLike&prod_id="+prod_id+"&variant_id="+variant_id+"&score="+score+"&qty="+qty,success:heartRatingToLocalStorage,error:ajaxFailHandler})}function heartRatingToLocalStorage(){if(!g_localStorageEnabled)return!1;var likes_arr=localStorage.getItem("likes_arr");if(null!==likes_arr){likes_arr=JSON.parse(likes_arr);for(var arrLen=likes_arr.length,i=0;i<arrLen;i++)if(likeItem=likes_arr[i],likeItem.prod_id==this.prod_id&&likeItem.variant_id==this.variant_id)return this.score>0?(likes_arr[i].score=this.score,likes_arr[i].qty=this.qty):likes_arr.splice(i,1),void localStorage.setItem("likes_arr",JSON.stringify(likes_arr));likes_arr.push({prod_id:this.prod_id,variant_id:this.variant_id,score:this.score,qty:this.qty}),localStorage.setItem("likes_arr",JSON.stringify(likes_arr))}}function renderHeartRating(score){var onleave=!1,productCode=g_prod_property.code;null===score&&(onleave=!0,score=g_localStorageEnabled?localStorage.getItem(productCode):0);for(var heart_ind=1;heart_ind<=3;heart_ind++){var heart=el("heart_rating_"+heart_ind);heart.src=heart_ind<=score?"/img/like-heart-selected.png":"/img/like.png"}if(!onleave)switch(score){case 1:el("target-div-hint").innerHTML="I like this";break;case 2:el("target-div-hint").innerHTML="I love this";break;case 3:el("target-div-hint").innerHTML="I adore this";break;default:el("target-div-hint").innerHTML="Like this?"}}function reviewHelpful(review_id,state){return g_customerUsername?void $.ajax({type:"POST",url:"?review_helpful="+review_id+"&state="+state,success:reviewUsefulSuccess,error:ajaxFailHandler}):void openLoginModal("/login")}function reviewUsefulSuccess(data){var json=JSON.parse(data);if(1==json.state){var review_helpful_count=el(json.review_id+"_helpful_count");review_helpful_count.innerHTML=json.count,review_helpful_count.style.color="rgb(244,108,36)",el(json.review_id+"_helpful_count_wrapper").style.cssFloat="right"}else el(json.review_id+"_helpful_count").style.color="rgb(255,0,0)",el(json.review_id+"_helpful_count_wrapper").style.cssFloat="right";el(json.review_id+"_helpful_buttons").style.display="none"}function openNewReviewInputs(login_check){if("undefined"==typeof login_check&&(login_check=!0),$("html, body").animate({scrollTop:$("#product_reviews_section").offset().top},1e3),login_check===!0&&!g_customerUsername){if(g_localStorageEnabled){localStorage.setItem("spr",1);var variant_id=el("selected-variant-id").value;""!==variant_id&&localStorage.setItem("spr_variant",variant_id)}return openLoginModal("/login"),!1}return $("#new_review_button, #product_no_reviews").hide(),$("#new_review_form").slideDown("slow"),el("review_list").style.opacity=.2,$(".review_field[data-id='1'] .progress").attr("id","focusedInput"),!1}function nextFormFocus(value){var dataID=parseInt(getAttr(value,"id"));1===dataID?$(".review_field[data-id='"+(dataID+1)+"'").slideDown("fast","swing"):($(".review_field").slideDown("fast","swing"),$("#post-new-review").slideDown("fast","swing"));var review_field=$(".review_field[data-id='"+dataID+"'");review_field.slideDown("fast","swing"),review_field.find(".progress").attr("id","focusedInput")}function closeNewSubmitForm(){return $("#new_review_button,#product_no_reviews").show(),$("#new_review_form").slideUp("slow"),el("review_list").style.opacity=1,!1}function onAspectMouseover(type,value){for(i=1;i<=5;i++)el(type+"_aspect_selecter_"+i).className="segment";for(var i=1;i<=value;i++)1!=value?value>1&&value<=3?el(type+"_aspect_selecter_"+i).className="segment average":value>3&&(el(type+"_aspect_selecter_"+i).className="segment good"):el(type+"_aspect_selecter_"+i).className="segment bad"}function onAspectMouseleave(type){var selected=!1;for(i=1;i<=5;i++){var element=el(type+"_aspect_selecter_"+i);1==getAttr(element,"selected")&&(selected=!0)}if(!selected)for(i=1;i<=5;i++)el(type+"_aspect_selecter_"+i).className="segment"}function onAspectClick(type,value){var element=el(type+"_aspect_selecter_"+value);setAttr(element,"selected","1"),el("review_"+type+"_score").value=20*value}function onReadMore(review_id){el("short_comment_"+review_id).style.display="none",el("full_comment_"+review_id).style.display="block"}function onReadLess(review_id){el("short_comment_"+review_id).style.display="block",el("full_comment_"+review_id).style.display="none"}function sortReviews(order,product_id){var load_more_btn=$("#load_more_reviews");load_more_btn.attr("data-page",2),g_review_order=order,loadReviewsCall=$.ajax({type:"GET",url:"?action=loadreviews&pid="+product_id+"&page=1&order_by="+g_review_order}),loadReviewsCall.then(renderProductSortReviews,ajaxFailHandler)}function loadReviews(data,order){return el("review").innerHTML=data,el("order_recent").className="button",el("order_helpful").className="button","recent"===order?void(el("order_recent").className="button selected"):void(el("order_helpful").className="button selected")}function validateReviewSubmission(){var content=el("new_review_content"),content_val=content.value;if(0===content_val.length)return content.style.border="1px solid #a94442",!1;var score_sel_wrapper=el("score_sel_wrapper");return 0===g_reviewQualityScore||0===g_reviewValueScore?(score_sel_wrapper.style.border="1px solid #a94442",!1):(content.style.border="1px solid grey",score_sel_wrapper.style.border="1px solid grey",!0)}function revSegmentHover(type,value){switch(colorReviewSegments(type,value),type){case 1:updateReviewOverallScore(g_reviewValueScore,20*value);break;case 2:updateReviewOverallScore(g_reviewQualityScore,20*value)}}function revSegmentLeave(type){switch(type){case 1:colorReviewSegments(type,g_reviewQualityScore/20);break;case 2:colorReviewSegments(type,g_reviewValueScore/20)}updateReviewOverallScore(g_reviewValueScore,g_reviewQualityScore)}function setRevScore(type,score){switch(type){case 1:g_reviewQualityScore=20*score;break;case 2:g_reviewValueScore=20*score}colorReviewSegments(type,score),updateReviewOverallScore(g_reviewValueScore,g_reviewQualityScore)}function updateReviewOverallScore(score_1,score_2){var score="none"!==$(".review_field[data-id=2]").css("display")?(score_1+score_2)/2:score_2;el("review_score_thumb").style.display=score<60?"none":"inline-block",el("overallReviewScore").innerHTML=score+"%"}function colorReviewSegments(type,score){for(var type_name=1===type?"qual":"val",i=1;i<6;i++){var elem=el("rev_"+type_name+"_segment_"+i);elem.style.backgroundColor="transparent"}for(var i=1;i<score+1;i++){var elem=el("rev_"+type_name+"_segment_"+i);switch(i){case 1:var color="#C9302C";break;case 2:var color="#D55228";break;case 3:var color="#EC971F";break;case 4:var color="#7C9B38";break;case 5:var color="#449D44"}null!==elem&&(elem.style.backgroundColor=color,el("overallReviewScore").style.color=color,el("review_score_thumb").style.color=color)}}function submitProductReview(){return!!validateReviewSubmission()&&(data={action:"submit_review",customer_id:$("input[name='review_customer_id']").val(),product_id:el("product_id").value,quality_score:g_reviewQualityScore,value_score:g_reviewValueScore,overall_score:(g_reviewValueScore+g_reviewQualityScore)/2,review_title:el("new_review_title_input").value,review_content:el("new_review_content").value},$.ajax({type:"POST",data:data,success:renderReviews,error:ajaxFailHandler}),!1)}function renderReviews(data){resetSubmitReviewInputs(),el("product_reviews_section").innerHTML="",initProductReviews()}function resetSubmitReviewInputs(){el("new_review_title_input").value="",el("new_review_content").value="",g_reviewQualityScore=0,g_reviewValueScore=0,updateReviewOverallScore(0,0),colorReviewSegments(1,0),colorReviewSegments(2,0)}function URLCheckForPostLoginOpts(){if(g_localStorageEnabled){var sfl=localStorage.getItem("sfl"),spr=localStorage.getItem("spr"),ebis=localStorage.getItem("ebis");if(null!==sfl){if(g_customerUsername===!1)return void localStorage.removeItem("sfl");if("product"!==sfl)for(var i=0;i<g_variantArr.length;i++)if(g_variantArr[i].sku==sfl){window.location.hash=sfl,sfl=g_variantArr[i].id;break}return g_sfl_pending=!0,itemSaveForLater(g_prod_id,sfl,1,!0),g_sfl_pending=!1,void localStorage.removeItem("sfl")}if(null!==ebis){if(g_customerUsername===!1)return void localStorage.removeItem("ebis");for(var i=0;i<g_variantArr.length;i++)if(ebis==g_variantArr[i].id){window.location.hash=g_variantArr[i].sku;break}return emailBackInStock(ebis,!0),void localStorage.removeItem("ebis")}if(null!==spr){if(g_customerUsername===!1)return localStorage.removeItem("spr"),void localStorage.removeItem("spr_variant");for(var variant_id=localStorage.getItem("spr_variant"),i=0;i<g_variantArr.length;i++)if(variant_id==g_variantArr[i].id){window.location.hash=g_variantArr[i].sku;break}return loadReviewsCall.done(function(){openNewReviewInputs(!1)}),localStorage.removeItem("spr"),void localStorage.removeItem("spr_variant")}}}function productLikeFind(){if(!g_localStorageEnabled)return!1;$(".product-like-this").show();var prod_id=g_variantArr[0].prod_id,variant_id=el("selected-variant-id").value;""===variant_id&&(variant_id=0);var likes_arr=localStorage.getItem("likes_arr");if(null!==likes_arr){likes_arr=JSON.parse(likes_arr);for(var arrLen=likes_arr.length,i=0;i<arrLen;i++)if(likeItem=likes_arr[i],likeItem.prod_id==prod_id&&likeItem.variant_id==variant_id)return void(likeItem.score>0&&renderHeartRating(likeItem.score))}}function selectAttrFilterByVariant(variant_item){0===g_remainingVariants.length&&(g_remainingVariants=g_variantArr);for(var attribute_name in variant_item.attributes)if(null!==variant_item.attributes[attribute_name]){var filter_attr=null;filter_attr="_swatch"===attribute_name?$("li.attribute-square[data-attrval='"+variant_item.attributes._hex+"'][data-attrname='"+attribute_name+"'] > span"):$("li.attribute-flex[data-attrval='"+variant_item.attributes[attribute_name]+"'][data-attrname='"+attribute_name+"'] > span.js-filter-btn"),null!==filter_attr&&0!==filter_attr.length&&g_remainingVariants.length>1&&null!=filter_attr[0]&&filter_attr[0].click()}}function findGTMProduct(product_id){if("undefined"==typeof gtm_product_data)return!1;for(var product,i=0,arr_len=gtm_product_data.length;i<arr_len;i++)if(product=gtm_product_data[i],product.prod_id==product_id){if(isNaN(product.price)){var price_arr=product.price.match(/[\d\.]+/g);price_arr&&(product.price=price_arr[0])}return product}return!1}function onProductImpressionClick(target,product_id){var product=findGTMProduct(product_id);if(!product)return!0;var variant=target.href.match(/\#(\d{6})/);return product.variant=void 0!==variant[1]?variant[1]:"",dataLayer.push({event:"productClick",ecommerce:{click:{actionField:{list:product.list},products:[product]}}}),!0}function onGTMProductBasketAdd(form_id){for(var product_id,quantity,current_form=el(form_id),i=0,arr_len=current_form.elements.length;i<arr_len;i++){var form_element=current_form.elements[i];switch(form_element.name){case"prod_id":product_id=form_element.value;break;case"quantity":quantity=form_element.value}}if(!product_id)return!0;var product=findGTMProduct(product_id);if(product){el("product-dyn-price");void 0!==product.variant&&""!=product.variant||(product.variant=gtmFindVariantCode()),product.quantity=quantity,fireGAEvent("eCommerce","addToCart","Add Product to Basket","/addtocart","Add item to Cart"),dataLayer.push({event:"addToCart",ecommerce:{currencyCode:"GBP",add:{products:[product]}}})}}function gtmFindVariantCode(){return void 0!==g_remainingVariants.length&&1==g_remainingVariants.length?g_remainingVariants[0].code:""}function renderPriceWasInfo(){$("#product-was-price, #product-price-saving, #product-rrp-price").hide();var selected_variant=!1;return 0===g_remainingVariants.length&&1===g_variantArr.length&&(selected_variant=g_variantArr[0]),1==g_remainingVariants.length&&(selected_variant=g_remainingVariants[0]),selected_variant!==!1&&null!==selected_variant.price_was&&selected_variant.price_was!==selected_variant.price_rrp?($("#product-was-price-val").html(formatPriceToPound(selected_variant.price_was)),$("#product-price-saving-perc").html(selected_variant.price_was_percent),$("#product-was-price").show(),void(null!==selected_variant.price_was_save&&($("#product-price-saving-val").html(formatPriceToPound(selected_variant.price_was_save)),$("#product-price-saving").show()))):selected_variant!==!1&&null!==selected_variant.price_rrp&&selected_variant.price_rrp>selected_variant.price?($("#product-rrp-price-val").html(formatPriceToPound(selected_variant.price_rrp)),$("#product-price-saving-perc").html(selected_variant.price_was_percent),$("#product-was-price").hide(),$("#product-rrp-price").show(),void(null!==selected_variant.price_was_save&&($("#product-price-saving-val").html(formatPriceToPound(selected_variant.price_was_save)),$("#product-price-saving").show()))):selected_variant===!1&&null!==g_filteredPrice.priceRRP&&g_filteredPrice.priceRRP==g_filteredPrice.priceWas&&g_filteredPrice.priceRRP>g_filteredPrice.price?($("#product-rrp-price-val").html(formatPriceToPound(g_filteredPrice.priceRRP)),$("#product-price-saving-val").html(formatPriceToPound(g_filteredPrice.priceWasSave)),$("#product-price-saving-perc").html(g_filteredPrice.priceWasPercent),$("#product-was-price").hide(),$("#product-rrp-price").show(),void(null!==selected_variant.price_was_save&&($("#product-price-saving-val").html(formatPriceToPound(g_filteredPrice.priceWasSave)),$("#product-price-saving").show()))):void(null!==g_filteredPrice&&null!==g_filteredPrice.priceWas&&($("#product-was-price-val").html(formatPriceToPound(g_filteredPrice.priceWas)),showEl("product-was-price"),g_filteredPrice.priceWasSave&&($("#product-price-saving-val").html(formatPriceToPound(g_filteredPrice.priceWasSave)),g_filteredPrice.priceWasPercent&&$("#product-price-saving-perc").html(g_filteredPrice.priceWasPercent),showEl("product-price-saving"))))}function geoProductUpdate(data){var collectStatus=document.querySelector("#geo_prod_collection_status"),deliveryStatus=document.querySelector("#geo_prod_delivery_status");return el("geo_prod_delivery_status")&&(data.delivery===!0?(el("geo_prod_delivery_status").classList.add("geo_prod_delivery_available"),deliveryStatus.textContent="Available",deliveryStatus.style.color="#3C7F53",1===g_remainingVariants.length&&showProductButton("add_to_basket"),data.free_delivery===!0&&($(".free-delivery").removeClass("hidden"),$(".product-delivery-price").addClass("hidden"))):"oos"===data.delivery?(el("geo_prod_delivery_status").classList.remove("geo_prod_delivery_available"),deliveryStatus.textContent="Out of stock",deliveryStatus.style.color="#ec1c24",data.stock_email===!0?showProductButton("cancel_email"):1===g_remainingVariants.length&&showProductButton("out_of_stock")):"unavailable_instore"===data.delivery?(el("geo_prod_delivery_status").classList.remove("geo_prod_delivery_available"),deliveryStatus.textContent="Not orderable on Rstore",deliveryStatus.style.color="#ec1c24",showProductButton("unavailable_instore")):(el("geo_prod_delivery_status").classList.remove("geo_prod_delivery_available"),deliveryStatus.textContent="Unavailable",deliveryStatus.style.color="#ec1c24",showProductButton("unavailable"))),el("geo_prod_collect_store")&&(data.collection===!0?(data.store_arr&&(geoRenderCollectStores(data.store_arr),showEl("store_avail_container"),showEl("geo_prod_showmore")),el("geo_prod_collect_store").innerHTML=data.nearest_store?"Order for collection at <strong>The Range, "+data.nearest_store+"</strong>":"",showEl("geo_prod_collect_store"),collectStatus.textContent="Available",collectStatus.style.color="#3C7F53"):"oos"===data.collection?(el("geo_prod_collect_store").innerHTML="This item is not available for collection.",showEl("geo_prod_collect_store"),hideEl("geo_prod_showmore"),el("store_avail_container").innerHTML="",hideEl("store_avail_container"),collectStatus.textContent="Out of stock",collectStatus.style.color="#ec1c24"):"unavailable_instore"===data.delivery?(el("geo_prod_collect_store").innerHTML="",showEl("geo_prod_collect_store"),hideEl("geo_prod_showmore"),el("store_avail_container").innerHTML="",hideEl("store_avail_container"),collectStatus.textContent="Not orderable on Rstore",collectStatus.style.color="#ec1c24"):(el("geo_prod_collect_store").innerHTML="This item is not available for collection.",showEl("geo_prod_collect_store"),hideEl("geo_prod_showmore"),el("store_avail_container").innerHTML="",hideEl("store_avail_container"),collectStatus.textContent="Unavailable",collectStatus.style.color="#ec1c24")),data.delivery!==!1&&1==g_remainingVariants.length&&showEl("geo_product_wrapper"),void 0===data.show||data.show?showEl("geo_prod_collection"):hideEl("geo_prod_collection"),data.get_it_by===!1||void 0===data.get_it_by||"oos"===data.delivery&&data.delivery!==!1||"oos"===data.collection||1!=g_remainingVariants.length?(el("product-get-it-by").style.display="none",el("product-get-it-by-val").textContent=""):(el("product-get-it-by").style.display="block",el("product-get-it-by-val").textContent=data.get_it_by),!0}function calcFulfilmentSectionHeight(section){$("#"+section+"_left_column").height($("#"+section+"_right_column").height())}function equaliseSliders(){setTimeout(function(){equaliseHeights(".slide-title"),equaliseHeights(".details")},1e3)}var g_variantArr=[],g_ggl_prod_arr=[],g_activeFilters={},g_prod_sfl=!1,g_filteredPrice=null,g_activeFilters={},g_filteredPrice=null,g_filteredSpecification=null,g_filterVarCount=null,g_availableFilters=null,g_mainImage=null,g_galerySlider=null,g_prod_id=null,g_prod_instore_only=!1,g_prod_property={},g_prod_title=null,g_prod_features=null,g_prod_desc=null,g_prod_specs=null,g_prod_code=null,g_prod_price=null,g_prod_min_price=null,g_prod_min_cmp_price=null,g_prod_goes_well=null,g_promoObj={},g_fullPromoObj={},g_show_price_was=!0,g_prod_review_score=!1,g_prod_review_count=!1,g_modalLoginEmail=null,g_sfl_pending=!1,g_customerCountry=null,g_customerCountryFull=null,g_remainingVariants=[],g_selectedAttributes=[],g_maxAttrCount=0,g_selectedAttrCount=0,g_reviewValueScore=0,g_reviewQualityScore=0,useful_review_arr=[],pending_review=!1,loadReviewsCall,resizeTimer,g_atb_on_load=!1,g_autoStoreStock=!1,promotion_arr=!1,g_no_geo_error=!0,g_review_order="overall_score";