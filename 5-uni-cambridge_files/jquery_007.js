!function($){"use strict";$.jscroll={defaults:{debug:!1,autoTrigger:!0,autoTriggerUntil:!1,loadingHtml:"<small>Loading...</small>",padding:0,nextSelector:"a:last",contentSelector:"",pagingSelector:"",callback:!1}};var jScroll=function($e,options){var _data=$e.data("jscroll"),_userOptions="function"==typeof options?{callback:options}:options,_options=$.extend({},$.jscroll.defaults,_userOptions,_data||{}),_isWindow="visible"===$e.css("overflow-y"),_$next=$e.find(_options.nextSelector).first(),_$window=$(window),_$body=$("body"),_$scroll=_isWindow?_$window:$e,_nextHref=$.trim(_$next.attr("href")+" "+_options.contentSelector),_preloadImage=function(){var src=$(_options.loadingHtml).filter("img").attr("src");if(src){var image=new Image;image.src=src}},_wrapInnerContent=function(){$e.find(".jscroll-inner").length||$e.contents().wrapAll('<div class="jscroll-inner" />')},_nextWrap=function($next){var $parent;_options.pagingSelector?$next.closest(_options.pagingSelector).hide():($parent=$next.parent().not(".jscroll-inner,.jscroll-added").addClass("jscroll-next-parent").hide(),$parent.length||$next.wrap('<div class="jscroll-next-parent" />').parent().hide())},_destroy=function(){return _$scroll.unbind(".jscroll").removeData("jscroll").find(".jscroll-inner").children().unwrap().filter(".jscroll-added").children().unwrap()},_observe=function(){_wrapInnerContent();var $inner=$e.find("div.jscroll-inner").first(),data=$e.data("jscroll"),borderTopWidth=parseInt($e.css("borderTopWidth"),10),borderTopWidthInt=isNaN(borderTopWidth)?0:borderTopWidth,iContainerTop=parseInt($e.css("paddingTop"),10)+borderTopWidthInt,iTopHeight=_isWindow?_$scroll.scrollTop():$e.offset().top,innerTop=$inner.length?$inner.offset().top:0,iTotalHeight=Math.ceil(iTopHeight-innerTop+_$scroll.height()+iContainerTop);if(!data.waiting&&iTotalHeight+_options.padding>=$inner.outerHeight())return _debug("info","jScroll:",$inner.outerHeight()-iTotalHeight,"from bottom. Loading next request..."),_load()},_checkNextHref=function(data){return data=data||$e.data("jscroll"),data&&data.nextHref?(_setBindings(),!0):(_debug("warn","jScroll: nextSelector not found - destroying"),_destroy(),!1)},_setBindings=function(){var $next=$e.find(_options.nextSelector).first();$next.length&&(_options.autoTrigger&&(_options.autoTriggerUntil===!1||_options.autoTriggerUntil>0)?(_nextWrap($next),_$body.height()<=_$window.height()&&_observe(),_$scroll.unbind(".jscroll").bind("scroll.jscroll",function(){return _observe()}),_options.autoTriggerUntil>0&&_options.autoTriggerUntil--):(_$scroll.unbind(".jscroll"),$next.bind("click.jscroll",function(){return _nextWrap($next),_load(),!1})))},_load=function(){var $inner=$e.find("div.jscroll-inner").first(),data=$e.data("jscroll");return data.waiting=!0,$e.animate({scrollTop:$inner.outerHeight()},0,function(){$.get(data.nextHref,function(r,status){if("error"===status)return _destroy();$(".jscroll-next-parent",$e).remove(),data.waiting=!1,$inner.append(r);var $next=$inner.find(_options.nextSelector).first();data.nextHref=!!$next.attr("href")&&$.trim($next.attr("href")+" "+_options.contentSelector),_checkNextHref(),_options.callback&&_options.callback.call(this),_debug("dir",data)})})},_debug=function(m){if(_options.debug&&"object"==typeof console&&("object"==typeof m||"function"==typeof console[m]))if("object"==typeof m){var args=[];for(var sMethod in m)"function"==typeof console[sMethod]?(args=m[sMethod].length?m[sMethod]:[m[sMethod]],console[sMethod].apply(console,args)):console.log.apply(console,args)}else console[m].apply(console,Array.prototype.slice.call(arguments,1))};return $e.data("jscroll",$.extend({},_data,{initialized:!0,waiting:!1,nextHref:_nextHref})),_wrapInnerContent(),_preloadImage(),_setBindings(),$.extend($e.jscroll,{destroy:_destroy}),$e};$.fn.jscroll=function(m){return this.each(function(){var jscroll,$this=$(this),data=$this.data("jscroll");data&&data.initialized||(jscroll=new jScroll($this,m))})}}(jQuery);